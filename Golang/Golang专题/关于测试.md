# 关于测试

一般情况下，测试源码文件只会针对某个命令源码文件或库源码文件做测试，所以应该将其放在同一个代码包内。
测试源码文件`*_test.go`应该以被测源码文件名为前导。
对于功能测试(`test`)，测试函数名应以`Test`为前缀，函数参数类型为`*testing.T`。对于基准测试(`benchmark`)，测试函数名应以`Benchmark`为前缀，函数参数类型为`*testing.B`。对于示例测试(`example`)，测试函数名应以`Example`为前缀，函数参数类型无限制。
示例测试严格来讲其实也是功能测试，只是更关注程序打印出来的内容。
默认情况命令会串行执行测试函数，

## go test 命令

```bash
# go test对测试成功的结果会进行缓存
# 清除测试缓存
go clean -testcache
# 清理全部缓存
go clean -cache

go test -parallel 10 demo -v # -parallel是指定最大并发数，对性能测试无效，-v是输出所有常规测试日志
```

```go
package main
func TestDemo(t *testing.T){
    // 执行t.FailNow当前函数会立即终止
    t.Fail()

    // t.Log与t.Logf用于打印常规测试日志
    // t.Error与t.Errorf相当于连续调用Fail和Log方法
    // t.Fatal和t.Fatalf相当于Log之后FailNow
    t.Fatal("Failed")
}
```

## 执行性能测试

```bash
# -bench=.表示执行所有基准测试函数
# -run=^$表示不执行功能测试函数
# -cpu代表可以同时运行goroutine的逻辑CPU的最大个数
# -count代表重复执行测试函数数
go test -bench=. -run=^$ -cpu=[8, 6] -count 5 demo
```

$$
\begin{aligned}
性能测试函数的执行次数=&逻辑CPU列表中的正整数个数\\
&\times重复执行测试函数数\\
&\times探索性执行测试函数的实际次数
\end{aligned}
$$

$$
\begin{aligned}
功能测试函数的执行次数=&逻辑CPU列表中的正整数个数\\
&\times重复执行测试函数数
\end{aligned}
$$

单元测试就是对单一的功能模块进行边界清晰的测试，并且不参杂任何对外部环境的检测，因而如不可避免依赖一些外部环境的话，应该在测试中`mock`外部环境

```go
package main
import testing

func BenchmarkDemo(b *testing.B) {
    // 性能测试计时器
    b.StopTimer()

    b.StartTimer()
}
```
