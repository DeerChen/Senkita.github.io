# 反射机制

## 什么是反射机制？

1. 反射(`reflect`)可以在运行时动态获取变量信息
2. 通过反射，可以修改变量的值，即调用方法

```go
package main

import (
	"fmt"
	"reflect"
)

type Person struct {
	Name   string `json:"name"`
	Age    int    `json:"age"`
	Sexual string `json:"gender"`
}

func main() {
	p := Person{
		Name:   "Lili",
		Age:    20,
		Sexual: "female",
	}

	rVal := reflect.ValueOf(p)
	// reflect类型转为interface{}
	iVal := rVal.Interface()
	// interface{}转为原类型
	v := iVal.(Person)
	fmt.Println(v)

	ageVal := reflect.ValueOf(&p.Age)
	// .Elem用于获取指向变量的指针
	ageVal.Elem().SetInt(18)
	fmt.Println(p)
}

func jsonTags(v interface{}) {
	// 获取reflect类型
	vType := reflect.TypeOf(v)
	// 原类型转为reflect类型
	val := reflect.ValueOf(v)
	// reflect.Value.Kind是类型种类
	vKind := val.Kind()

	if vKind != reflect.Struct {
		return
	}
	// 获取字段数
	fieldNum := val.NumField()
	// 获取方法数
	methodNum := val.NumMethod()

	for i := 0; i < fieldNum; i++ {
		// 获取标签
		tagVal := vType.Field(i).Tag.Get("json")
		if tagVal != "" {
			fmt.Println(tagVal)
		}
	}

	if methodNum != 0 {
		// 方法排序按函数名的ASCII码
		val.Method(0).Call(nil)
	}
}
```
